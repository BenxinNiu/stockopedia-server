<html>
<head>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">

$(document).ready(function(){

    var getData= [['time','price']];
    var urlAddress = "/historicalprice/AAPL/current_year";

    //Assign the right url to urlAddress by clicking different buttons
    $( "#current_year" ).click(function() {
    $.ajax({
              url: "/historicalprice/AAPL/current_year",
              type: "GET",
              success: function(result){

                var length = result.length;
                for(i=0;i<length;i++){
                getData.push([result[length-i-1].date,result[length-i-1].close]);
                 $("#cureve_chart").empty();
                 drawChart(getData);
                  } // forloop
                },
              error:function(err){
              console.log(err);
           }

        });


    });

    $( "#prev_year" ).click(function() {

    $.ajax({
              url: "/historicalprice/AAPL/prev_year",
              type: "GET",
              success: function(result){

                var length = result.length;
                for(i=0;i<length;i++){
                getData.push([result[length-i-1].date,result[length-i-1].close]);
                  $("#cureve_chart").empty();
                  drawChart(getData);
                  } // forloop
                },
              error:function(err){
              console.log(err);
           }

        });


    });

     $( "#one_month" ).click(function(){
            $.ajax({
              url: "/historicalprice/AAPL/current_month",
              type: "GET",
              success: function(result){

                var length = result.length;
                for(i=0;i<length;i++){
                getData.push([result[length-i-1].date,result[length-i-1].close]);
                  } // forloop
                },
              error:function(err){
              console.log(err);
           }

        });
              //chart.clearChart();
              drawChart(getData);

    });

    $( "#one_week" ).click(function() {
    $.ajax({
              url: "/historicalprice/AAPL/current_week",
              type: "GET",
              success: function(result){

                var length = result.length;
                for(i=0;i<length;i++){
                getData.push([result[length-i-1].date,result[length-i-1].close]);
                  } // forloop
                },
              error:function(err){
              console.log(err);
           }

        });
        chart.clearChart();
        //drawChart(getData);

    });

    //send ajax request to get previous year data
    var chart;
     $.ajax({
              url: urlAddress,
              type: "GET",
              success: function(result){

                var length = result.length;
                for(i=0;i<length;i++){
                getData.push([result[length-i-1].date,result[length-i-1].close]);
                  } // forloop
                 // console.log(length);
                 chart =  drawChart(getData);
                },
              error:function(err){
              console.log(err);
           }

        });


    // Draw the line chart
     google.charts.load('current', {'packages':['corechart']});
      google.charts.setOnLoadCallback(drawChart);

      function drawChart(getData) {

        var options = {
          title: 'Stock Price',
          curveType: 'function',
          legend: { position: 'bottom' }
        };
        chart = new google.visualization.LineChart(document.getElementById('curve_chart'));

        chart.draw(google.visualization.arrayToDataTable(getData), options);
      }


        });




</script>
</head>
<body>
<head1>Stockopedia</head1>
<div id="curve_chart" style="width: 900px; height: 500px"></div>
    <div class="row_fluid">
        <button id="current_year">Current Year</button>
        <button id="prev_year">Previous Year</button>
        <button id="one_week"> One Week</div>
        <button id="one_month"> One Month</button>
    </div>

</body>
</html>
